version: "3.9"

services:
  # --- TU APP PHP (Backend) ---
  app-php:
    image: servidorappphp-php # O la imagen que uses para PHP
    volumes:
       - ./app:/var/www/html

  # --- TU NGINX ACTUAL (Procesador PHP) ---
  # Este es el de tu carpeta 'web' de la foto
  app-web:
    build: 
      context: ./web
    expose:
      - "80"  # ⚠️ IMPORTANTE: Ya no usamos "ports", solo "expose" interno
    volumes:
      - ./app:/var/www/html
    depends_on:
      - app-php

  # --- EL NUEVO PORTERO (Proxy / HTTPS) ---
  proxy:
    image: nginx:latest
    ports:
      - "80:80"   # Este sí da la cara a internet
      - "443:443"
    volumes:
      - ./proxy/nginx.conf:/etc/nginx/nginx.conf
      - ./certbot/conf:/etc/letsencrypt
      - ./certbot/www:/var/www/certbot
    depends_on:
      - app-web

  # --- GESTOR DE CERTIFICADOS ---
  certbot:
    image: certbot/certbot
    volumes:
      - ./certbot/conf:/etc/letsencrypt
      - ./certbot/www:/var/www/certbot